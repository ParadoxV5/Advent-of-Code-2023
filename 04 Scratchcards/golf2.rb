Q=[1]*212
p$<.sum{|l|n=Q.pop;l[..39].scan(/.../).count{l[41..][_1]}.times{Q[~_1]+=n};n}